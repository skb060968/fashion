generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model Order {
  id            String          @id @default(cuid())
  amount        Int
  discount      Int             @default(0)        // ✅ new field for order-level discount
  paymentMethod PaymentMethod
  status        OrderStatus
  createdAt     DateTime        @default(now())

  address       Address?
  items         OrderItem[]
  history       StatusHistory[]
}

model Address {
  id           String   @id @default(cuid())
  fullName     String
  phone        String
  email        String?                         // ✅ new field for customer email
  addressLine1 String
  addressLine2 String?
  city         String
  state        String
  pincode      String

  order        Order    @relation(fields: [orderId], references: [id])
  orderId      String   @unique
}

model OrderItem {
  id             String @id @default(cuid())
  name           String
  slug           String
  size           String
  price          Int
  quantity       Int    @default(1)            // ✅ new field for number of items
  coverThumbnail String

  order          Order  @relation(fields: [orderId], references: [id])
  orderId        String
}

model StatusHistory {
  id        String      @id @default(cuid())
  status    OrderStatus
  changedAt DateTime    @default(now())

  order     Order       @relation(fields: [orderId], references: [id])
  orderId   String
}

enum PaymentMethod {
  UPI_MANUAL
  COD
}

enum OrderStatus {
  UNDER_VERIFICATION   // Order placed, payment claimed by customer
  VERIFIED             // Payment verified by admin
  REJECTED             // Payment rejected (fake / mismatch)

  PROCESSING           // Order accepted, being prepared
  SHIPPED              // Given to courier
  DELIVERED            // Successfully delivered

  CANCELLED            // Cancelled before shipment
  REFUNDED             // Money returned to customer
}